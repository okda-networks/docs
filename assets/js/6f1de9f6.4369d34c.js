"use strict";(self.webpackChunkokda_networks=self.webpackChunkokda_networks||[]).push([[850],{3817:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>u});var i=t(4848),a=t(8453),r=t(1470),s=t(9365);const o={sidebar_position:3,sidebar_label:"Network Namespace",title:"Linux Network Namespace Configuration"},l="Linux Network Namespace Configuration",c={id:"linux-networking/netns",title:"Linux Network Namespace Configuration",description:"A Linux network namespace provides an isolated network environment,",source:"@site/docs/2-linux-networking/4-netns.md",sourceDirName:"2-linux-networking",slug:"/linux-networking/netns",permalink:"/linux-networking/netns",draft:!1,unlisted:!1,editUrl:"https://github.com/okda-networks/docs_source/tree/main/docs/2-linux-networking/4-netns.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,sidebar_label:"Network Namespace",title:"Linux Network Namespace Configuration"},sidebar:"tutorialSidebar",previous:{title:"VRFs",permalink:"/linux-networking/vrf"}},d={},u=[{value:"Basic Network Namespace configuration",id:"basic-network-namespace-configuration",level:2},{value:"Topology",id:"topology",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Veth Configuration",id:"veth-configuration",level:3}];function p(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"linux-network-namespace-configuration",children:"Linux Network Namespace Configuration"}),"\n",(0,i.jsx)(e.p,{children:"A Linux network namespace provides an isolated network environment,\nallowing multiple instances of network stacks to coexist on a single host.\neach namespace has its own interfaces, IP addresses, FDB(L2 forwarding DB). and routing tables,\nensuring separation of network configurations.\nThis isolation is crucial for containerization and virtualization,\nensuring separate network configurations within shared hardware."}),"\n",(0,i.jsx)(e.p,{children:"Network namespace is equivalent to VPNs or VRFs in traditional network devices."}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"VETH"})," links are used to interconnect different ",(0,i.jsx)(e.code,{children:"NETNS"}),"(network namespace) and achieve connectivity\nbetween them."]}),"\n",(0,i.jsx)(e.admonition,{type:"info",children:(0,i.jsx)(e.p,{children:"Unlike Linux VRF links which provide routing table isolation for it's slave devices,\nthe network namespace has a complete isolation of the linux network stack."})}),"\n",(0,i.jsx)(e.h2,{id:"basic-network-namespace-configuration",children:"Basic Network Namespace configuration"}),"\n",(0,i.jsxs)(e.p,{children:["In this document, we will create two netns(network namespace), ",(0,i.jsx)(e.code,{children:"VPN10"})," and ",(0,i.jsx)(e.code,{children:"VPN20"}),",\nthen we will create two VETH links to interconnect the two netns to achive connectivity\nbetween them."]}),"\n",(0,i.jsx)(e.h3,{id:"topology",children:"Topology"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"topology1",src:t(9323).A+"",width:"665",height:"293"})}),"\n",(0,i.jsx)(e.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Create two netns (",(0,i.jsx)(e.code,{children:"vpn10"})," and ",(0,i.jsx)(e.code,{children:"vpn20"}),"), then we"]}),"\n",(0,i.jsxs)(e.li,{children:["Add ",(0,i.jsx)(e.code,{children:"enp0s4"})," link to ",(0,i.jsx)(e.code,{children:"vpn10"})," netns and  ",(0,i.jsx)(e.code,{children:"enp0s5"})," link to ",(0,i.jsx)(e.code,{children:"vpn20"})," netns."]}),"\n"]}),"\n","\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(s.A,{value:"onmcli",label:"ONM-CLI",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"dent-1(config)# netnses-iproute2\ndent-1(config-netnses-iproute2)# netns vpn10\ndent-1(config-netnses-iproute2)# netns vpn20\ndent-1(config-netnses-iproute2)# exit\ndent-1(config)# links-iproute2\ndent-1(config-links-iproute2)# link enp0s4\ndent-1(config-[name='enp0s4'])# netns vpn10\ndent-1(config-[name='enp0s4'])# ip 192.168.10.10/24\ndent-1(config-[name='enp0s4'])# admin-status up\ndent-1(config-[name='enp0s4'])# exit\ndent-1(config-links-iproute2)# link enp0s5\ndent-1(config-[name='enp0s5'])# netns vpn20\ndent-1(config-[name='enp0s5'])# ip 192.168.20.20/24\ndent-1(config-[name='enp0s5'])# admin-status up\ndent-1(config-[name='enp0s5'])# commit\n"})})}),(0,i.jsx)(s.A,{value:"iproute2",label:"IPROUTE2",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"ip netns add vpn10\nip netns add vpn20\nip link set name enp0s4 up netns vpn10\nip -n vpn10 address add 192.168.10.10/24 dev enp0s4\nip link set name enp0s5 up netns vpn20\nip -n vpn10 address add 192.168.10.10/24 dev enp0s4\n"})})}),(0,i.jsx)(s.A,{value:"netconf",label:"NETCONF",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<netnses>\n    <netns>\n        <name>vpn10</name>\n    </netns>\n    <netns>\n        <name>vpn20</name>\n    </netns>\n</netnses>\n<links>\n<link>\n    <name>enp0s4</name>\n    <admin-status>up</admin-status>\n    <netns>vpn10</netns>\n    <ip>\n        <address>192.168.10.10/24</address>\n    </ip>\n</link>\n<link>\n    <name>enp0s5</name>\n    <admin-status>up</admin-status>\n    <netns>vpn20</netns>\n    <ip>\n        <address>192.168.20.20/24</address>\n    </ip>\n</link>\n</links>\n"})})})]}),"\n",(0,i.jsxs)(e.admonition,{type:"note",children:[(0,i.jsx)(e.p,{children:"Now we have two PCs in different netns, if we check the fdb/arp table we can see\nthat each link PC ip belong to different netns"}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"dent-1# show config-running neighbors-iproute2 \n  neighbor 192.168.20.1 netns vpn20 \n    dev enp0s5\n    router false\n    use false\n    managed false\n    extern_learn false\n    lladdr e6:70:03:8d:7e:09\n    nud reachable\n  neighbor 192.168.10.1 netns vpn10 \n    dev enp0s4\n    router false\n    use false\n    managed false\n    extern_learn false\n    lladdr b6:1d:6e:03:0e:e6\n    nud stale\n\ndent-1# \n"})})]}),"\n",(0,i.jsx)(e.h3,{id:"veth-configuration",children:"Veth Configuration"}),"\n",(0,i.jsxs)(e.p,{children:["Now if we want to have connectivity between the two different netns, we will need\nto create a ",(0,i.jsx)(e.code,{children:"veth"})," link for each netns, and interconnect them."]}),"\n",(0,i.jsx)(e.p,{children:"To achieve this we do the following:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Create ",(0,i.jsx)(e.code,{children:"veth10"})," and set ",(0,i.jsx)(e.code,{children:"veth20"})," as its peer."]}),"\n",(0,i.jsx)(e.li,{children:"add each veth to it's netns."}),"\n",(0,i.jsx)(e.li,{children:"add route for each vpn client subnet (192.168.10.0/24 for vpn10) and (192.168.20.0/24 for vpn20).\nand the nexthop for those route are the veth interfaces."}),"\n"]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(s.A,{value:"onmcli",label:"ONM-CLI",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"dent-1(config-links-iproute2)# link veth10\ndent-1(config-[name='veth10'])# type iproute2-ip-link:veth\ndent-1(config-[name='veth10'])# virtual_peer_name veth20\ndent-1(config-[name='veth10'])# ip 1.1.1.9/30\ndent-1(config-[name='veth10'])# admin-status up\ndent-1(config-[name='veth10'])# netns vpn10\ndent-1(config-[name='veth10'])# exit\ndent-1(config-links-iproute2)# link veth20\ndent-1(config-[name='veth20'])# type iproute2-ip-link:veth\ndent-1(config-[name='veth20'])# netns vpn20\ndent-1(config-[name='veth20'])# ip 1.1.1.10/30\ndent-1(config-[name='veth20'])# admin-status up\ndent-1(config-[name='veth20'])# virtual_peer_name veth10\ndent-1(config-[name='veth20'])# exit\ndent-1(config)# routes-iproute2\ndent-1(config-routes-iproute2)# route 192.168.20.0/24 netns vpn10\ndent-1(config-[prefix='192.168.20.0/24'][netns='vpn10']# nexthop veth10\ndent-1(config-[prefix='192.168.20.0/24'][netns='vpn10']# exit\ndent-1(config-routes-iproute2)# route 192.168.10.0/24 netns vpn20\ndent-1(config-[prefix='192.168.10.0/24'][netns='vpn20']# nexthop veth20\ndent-1(config-[prefix='192.168.10.0/24'][netns='vpn20']# commit\n"})})}),(0,i.jsx)(s.A,{value:"iproute2",label:"IPROUTE2",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"ip -n vpn10 link add name veth10 up type veth peer name veth20\nip -n vpn10 address add 1.1.1.9/30 dev veth10\nip -n vpn10 link add name veth20 up type veth peer name veth10\nip -n vpn10 address add 1.1.1.10/30 dev veth20\nip -n vpn10 route add 192.168.20.0/24 nexthop dev veth10\nip -n vpn20 route add 192.168.10.0/24 nexthop dev veth20\n"})})}),(0,i.jsx)(s.A,{value:"netconf",label:"NETCONF",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:'\n<links xmlns="urn:okda:iproute2:ip:link" xmlns:yang="urn:ietf:params:xml:ns:yang:1" yang:operation="none">\n    <link>\n        <name>veth10</name>\n        <admin-status>up</admin-status>\n        <netns>vpn10</netns>\n        <ip>\n            <address>1.1.1.9/30</address>\n        </ip>\n        <type>veth</type>\n        <virtual_peer_name>veth20</virtual_peer_name>\n    </link>\n    <link>\n        <name>veth20</name>\n        <admin-status>up</admin-status>\n        <netns>vpn20</netns>\n        <ip>\n            <address>1.1.1.10/30</address>\n        </ip>\n        <type>veth</type>\n        <virtual_peer_name>veth10</virtual_peer_name>\n    </link>\n</links>\n<routes xmlns="urn:okda:iproute2:ip:route" xmlns:yang="urn:ietf:params:xml:ns:yang:1" yang:operation="none">\n<route>\n    <prefix>192.168.20.0/24</prefix>\n    <table>254</table>\n    <metric>0</metric>\n    <tos>default</tos>\n    <netns>vpn10</netns>\n    <nexthop>\n        <dev>veth10</dev>\n    </nexthop>\n</route>\n<route yang:operation="create">\n    <prefix>192.168.10.0/24</prefix>\n    <table>254</table>\n    <metric>0</metric>\n    <tos>default</tos>\n    <netns>vpn20</netns>\n    <nexthop yang:operation="create">\n        <dev>veth20</dev>\n    </nexthop>\n</route>\n</routes>\n\n'})})})]}),"\n",(0,i.jsx)(e.p,{children:"Now we should have connectivity between PC1 and PC2."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"PC1> ping 192.168.20.1\nPING 192.168.20.1 (192.168.10.1) 56(84) bytes of data.\n64 bytes from 192.168.20.1: icmp_seq=1 ttl=64 time=0.878 ms\n64 bytes from 192.168.20.1: icmp_seq=2 ttl=64 time=1.00 ms\n64 bytes from 192.168.20.1: icmp_seq=3 ttl=64 time=1.16 ms\n64 bytes from 192.168.20.1: icmp_seq=4 ttl=64 time=1.07 ms\n\n"})})]})}function h(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(p,{...n})}):p(n)}},9365:(n,e,t)=>{t.d(e,{A:()=>s});t(6540);var i=t(4164);const a={tabItem:"tabItem_Ymn6"};var r=t(4848);function s(n){let{children:e,hidden:t,className:s}=n;return(0,r.jsx)("div",{role:"tabpanel",className:(0,i.A)(a.tabItem,s),hidden:t,children:e})}},1470:(n,e,t)=>{t.d(e,{A:()=>j});var i=t(6540),a=t(4164),r=t(3104),s=t(6347),o=t(205),l=t(7485),c=t(1682),d=t(679);function u(n){return i.Children.toArray(n).filter((n=>"\n"!==n)).map((n=>{if(!n||(0,i.isValidElement)(n)&&function(n){const{props:e}=n;return!!e&&"object"==typeof e&&"value"in e}(n))return n;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof n.type?n.type:n.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(n){const{values:e,children:t}=n;return(0,i.useMemo)((()=>{const n=e??function(n){return u(n).map((n=>{let{props:{value:e,label:t,attributes:i,default:a}}=n;return{value:e,label:t,attributes:i,default:a}}))}(t);return function(n){const e=(0,c.X)(n,((n,e)=>n.value===e.value));if(e.length>0)throw new Error(`Docusaurus error: Duplicate values "${e.map((n=>n.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(n),n}),[e,t])}function h(n){let{value:e,tabValues:t}=n;return t.some((n=>n.value===e))}function m(n){let{queryString:e=!1,groupId:t}=n;const a=(0,s.W6)(),r=function(n){let{queryString:e=!1,groupId:t}=n;if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,l.aZ)(r),(0,i.useCallback)((n=>{if(!r)return;const e=new URLSearchParams(a.location.search);e.set(r,n),a.replace({...a.location,search:e.toString()})}),[r,a])]}function v(n){const{defaultValue:e,queryString:t=!1,groupId:a}=n,r=p(n),[s,l]=(0,i.useState)((()=>function(n){let{defaultValue:e,tabValues:t}=n;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map((n=>n.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const i=t.find((n=>n.default))??t[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:e,tabValues:r}))),[c,u]=m({queryString:t,groupId:a}),[v,f]=function(n){let{groupId:e}=n;const t=function(n){return n?`docusaurus.tab.${n}`:null}(e),[a,r]=(0,d.Dv)(t);return[a,(0,i.useCallback)((n=>{t&&r.set(n)}),[t,r])]}({groupId:a}),g=(()=>{const n=c??v;return h({value:n,tabValues:r})?n:null})();(0,o.A)((()=>{g&&l(g)}),[g]);return{selectedValue:s,selectValue:(0,i.useCallback)((n=>{if(!h({value:n,tabValues:r}))throw new Error(`Can't select invalid tab value=${n}`);l(n),u(n),f(n)}),[u,f,r]),tabValues:r}}var f=t(2303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(4848);function b(n){let{className:e,block:t,selectedValue:i,selectValue:s,tabValues:o}=n;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),d=n=>{const e=n.currentTarget,t=l.indexOf(e),a=o[t].value;a!==i&&(c(e),s(a))},u=n=>{let e=null;switch(n.key){case"Enter":d(n);break;case"ArrowRight":{const t=l.indexOf(n.currentTarget)+1;e=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(n.currentTarget)-1;e=l[t]??l[l.length-1];break}}e?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},e),children:o.map((n=>{let{value:e,label:t,attributes:r}=n;return(0,x.jsx)("li",{role:"tab",tabIndex:i===e?0:-1,"aria-selected":i===e,ref:n=>l.push(n),onKeyDown:u,onClick:d,...r,className:(0,a.A)("tabs__item",g.tabItem,r?.className,{"tabs__item--active":i===e}),children:t??e},e)}))})}function k(n){let{lazy:e,children:t,selectedValue:a}=n;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const n=r.find((n=>n.props.value===a));return n?(0,i.cloneElement)(n,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:r.map(((n,e)=>(0,i.cloneElement)(n,{key:e,hidden:n.props.value!==a})))})}function w(n){const e=v(n);return(0,x.jsxs)("div",{className:(0,a.A)("tabs-container",g.tabList),children:[(0,x.jsx)(b,{...e,...n}),(0,x.jsx)(k,{...e,...n})]})}function j(n){const e=(0,f.A)();return(0,x.jsx)(w,{...n,children:u(n.children)},String(e))}},9323:(n,e,t)=>{t.d(e,{A:()=>i});const i=t.p+"assets/images/netns-topology-4871e6e04751b209d1b70fb305b2daf1.png"},8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>o});var i=t(6540);const a={},r=i.createContext(a);function s(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:s(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);